@model IEnumerable<WMSPDA.Business.Base.Models.Dapper_PDA_V_StockQuery>

@{
    Layout = null;
}

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>库存查询</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="~/Content/MUI/css/mui.min.css">
		<!--App自定义的css-->
		<!-- <link rel="stylesheet" type="text/css" href="../css/app.css" /> -->

        <!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="~/Content/MUI/css/app.css" />

		<style>
			html,
			body {
				background-color: #efeff4;
			}
			p {
				text-indent: 0px;
			}
			span.mui-icon {
				font-size: 14px;
				color: #007aff;
				margin-left: -15px;
				padding-right: 10px;
			}
			.mui-off-canvas-left {
				color: #fff;
			}
			.title {
				margin: 35px 15px 10px;
			}
			.title {
				margin: 10px 15px 35px;
				color: #bbb;
				text-indent: 1em;
				font-size: 14px;
				line-height: 24px;
			}
			input {
				color: #000;
			}
		</style>

	</head>

	<body>

        <div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">

			<!--侧滑菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="title">@Resources.Lang.PDA_Common_Element_Search</div>
						<div class="content">
							
							<p style="margin: 10px 15px;display:none;">
								<button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;">@Resources.Lang.PDA_Common_Element_CloseSiteStorke</button>
							</p>

                            <div class="title" style="margin-bottom: 25px;display:none;">@Resources.Lang.PDA_Common_Element_SideStorkeExample</div>

                            <div class="mui-input-row" style="padding-left:15px;padding-right:15px;">
						       <input type="text" class="mui-input-clear" placeholder="SN" name="txtSN" id="txtSN" >
					        </div>
                           
                            <div class="mui-input-row" style="padding-left:15px;padding-right:15px;">
						       <input type="text" class="mui-input-clear" placeholder="@Resources.Lang.PDA_Common_Element_LiaoHao" name="txtCinvcode" id="txtCinvcode" >
					        </div>
                            <div class="mui-input-row" style="padding-left:15px;padding-right:15px;">
						        <input type="text" class="mui-input-clear" placeholder="@Resources.Lang.PDA_Common_Element_CPositionCode" name="txtPositionCode" id="txtPositionCode" >
					        </div>                         
                            <div class="mui-button-row" style="padding-left:15px;padding-right:15px;">
                                <button id="offCanvasHide_qry" type="button" class="mui-btn mui-btn-primary mui-icon mui-icon-search mui-right" style="width:100%;"> @Resources.Lang.PDA_Common_Element_Query </button>
                            </div>    
						</div>
					</div>
				</div>
			</aside>
			
            <!--主界面部分-->
			<div class="mui-inner-wrap">
				<header class="mui-bar mui-bar-nav">
					<a href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>

                    <button type="button" class="mui-btn mui-btn-link mui-pull-right" id="btnReturn">
		                 <span class="mui-icon mui-icon-home"></span>
		             </button>                
					<h1 class="mui-title" style="text-decoration:underline;color:#5A98FB;">库存查询</h1>
				</header>
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll">

                        <ul class="mui-table-view mui-table-view-striped mui-table-view-condensed">
                            
                            @foreach (WMSPDA.Business.Base.Models.Dapper_PDA_V_StockQuery bo in Model)
                            { 
                                
                                <li class="mui-table-view-cell">
                                    
		                            <div class="mui-table">
		                                <div class="mui-table-cell mui-col-xs-10">
		                                  <h4 class="mui-ellipsis">储位:@bo.CPOSITIONCODE</h4>
		                                    <h5>@Resources.Lang.PDA_Common_Element_LiaoHao:@bo.CINVCODE</h5>
                                            <h5>仓库编码:@bo.CWAREHOUSECODE &nbsp;数量:@bo.IQTY</h5>
		                                    <p class="mui-h6 mui-ellipsis">助记码:@bo.CALIAS  </p>
		                                </div>		                                                  
		                            </div>
                                   
		                        </li>
                            }

		                </ul>


                        <div class="mui-content-padded" style="display:none;">
							<p>
								<span class="mui-icon mui-icon-bars"></span> 
								<span class="android-only"></span>
							</p>
							<p style="padding: 5px 20px;margin-bottom: 5px;">
								<button id="offCanvasShow" type="button" class="mui-btn mui-btn-primary mui-btn-block" style="padding: 10px;">
									
								</button>
							</p>
							<p></p>

						</div>		
	<form class="mui-input-group" style="margin-bottom: 15px;display:none;">
							<div class="mui-input-row mui-radio">
								<label></label>
								<input name="style" type="radio" checked="" value="main-move">
							</div>
							<div class="mui-input-row mui-radio">
								<label></label>
								<input name="style" type="radio" value="menu-move">
							</div>
							<div class="mui-input-row mui-radio mui-hidden" id="move-togger">
								<label></label>
								<input name="style" type="radio" value="all-move">
							</div>
							<div class="mui-input-row mui-radio">
								<label></label>
								<input name="style" type="radio" value="main-move-scalable">
							</div>
						</form>	
					</div>
				</div>
				<!-- off-canvas backdrop -->
				<div class="mui-off-canvas-backdrop"></div>
                
			</div>
		</div>

		<script src="~/Content/MUI/js/mui.min.js"></script>
        <script src="~/Scripts/jquery-1.8.2.min.js"></script>  
        <script>

            var scrollDisabled = true;
            var CurrendIndex = 1;//当前页数

            //列表查询方法
            function SearchAsnList(IsAppend) {
                //debugger;
                //查询事件

                if (IsAppend) {
                    CurrendIndex = CurrendIndex + 1;//下一页
                }
                else {
                    CurrendIndex = 1;//查询，第一页
                }

                var sn = $("#txtSN").val();
                var cinvcode = $("#txtCinvcode").val();
                var cpositioncode = $("#txtPositionCode").val();
                //alert("SearchAsnList");
                $.ajax({
                    type: "get",
                    url: "/Stock/StockQuerySearch",
                    data: { sn: sn, cinvcode: cinvcode, postioncode: cpositioncode, CurrendIndex: CurrendIndex },
                    async: false,
                    success: function (data) {
                        //mui.alert(data);
                        scrollDisabled = true;
                        if (data != null && data != undefined && data.length > 0) {
                            if (!IsAppend) {
                                $(".mui-table-view").empty();
                            }
                            var liListhtml = '';
                            for (var i = 0; i < data.length; i++) {                             
                                liListhtml = liListhtml +
                                '<li class="mui-table-view-cell"> ' +
                                '	<div class="mui-table"> ' +
                                '		<div class="mui-table-cell mui-col-xs-10"> ' +
                               '			<h4 class="mui-ellipsis">储位:' + data[i].CPOSITIONCODE + ' </h4> ' +
                                '			<h5>@Resources.Lang.PDA_Common_Element_LiaoHao:' + data[i].CINVCODE + '</h5> ' +
                                 '			<h5>仓库编码:' + data[i].CWAREHOUSECODE + ' &nbsp;数量:' + data[i].IQTY + '</h5> ' +
                                '			<p class="mui-h6 mui-ellipsis"> 助记码:' + data[i].CALIAS + ' </p> ' +
                                '		</div> ' +                              
                                '	</div> ' +
                                '</li> ';

                            }
                            if (IsAppend) {
                                $(".mui-table-view").append(liListhtml);
                            }
                            else {
                                $(".mui-table-view").html(liListhtml);
                            }                         
                            scrollDisabled = false;
                            mui('#offCanvasContentScroll').pullRefresh().endPullupToRefresh(false);//参数为true代表没有更多数据了。
                        }
                        else {
                            //如果没有数据
                            CurrendIndex = CurrendIndex - 1;
                            scrollDisabled = true;
                            if (!IsAppend) {
                                $(".mui-table-view").empty();
                            }
                            mui('#offCanvasContentScroll').pullRefresh().endPullupToRefresh(true);//参数为true代表没有更多数据了。
                        }
                        //mui.alert(CurrendIndex);
                    },
                    error: function (msg) {
                        //alert(msg);
                        mui.alert("@Resources.Lang.PDA_Common_Tips_NetExceptionTryAgain");//网络异常，请重试!
                        mui('#offCanvasContentScroll').pullRefresh().endPullupToRefresh(false);//参数为true代表没有更多数据了。
                    }
                });

            }
           
            //mui.init();

            //下拉加载更多数据
            function pullfreshQry() {
                //业务逻辑代码，比如通过ajax从服务器获取新数据；
                //......
                //注意：
                //1、加载完新数据后，必须执行如下代码，true表示没有更多数据了：
                //2、若为ajax请求，则需将如下代码放置在处理完ajax响应数据之后
                setTimeout(SearchAsnList(true), 1500);
            }

            mui.init({
                pullRefresh: {
                    container: '#offCanvasContentScroll',//待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
                    up: {
                        height: 500,//可选.默认50.触发上拉加载拖动距离
                        auto: false,//可选,默认false.自动上拉加载一次
                        contentrefresh: "@Resources.Lang.PDA_Common_Tips_Loading",//正在加载... //可选，正在加载状态时，上拉加载控件上显示的标题内容
                        contentnomore: '@Resources.Lang.PDA_Common_Tips_NoMoreData',//没有更多数据了//可选，请求完毕若没有更多数据时显示的提醒内容；
                        callback: pullfreshQry //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
                    }
                }
            });

            //侧滑容器父节点
            var offCanvasWrapper = mui('#offCanvasWrapper');
            //主界面容器
            var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
            //菜单容器
            var offCanvasSide = document.getElementById("offCanvasSide");
            if (!mui.os.android) {
                document.getElementById("move-togger").classList.remove('mui-hidden');
                var spans = document.querySelectorAll('.android-only');
                for (var i = 0, len = spans.length; i < len; i++) {
                    spans[i].style.display = "none";
                }
            }
            //移动效果是否为整体移动
            var moveTogether = false;
            //侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
            var classList = offCanvasWrapper[0].classList;

            //变换侧滑动画移动效果；
            mui('.mui-input-group').on('change', 'input', function () {
                if (this.checked) {
                    offCanvasSide.classList.remove('mui-transitioning');
                    offCanvasSide.setAttribute('style', '');
                    classList.remove('mui-slide-in');
                    classList.remove('mui-scalable');
                    switch (this.value) {
                        case 'main-move':
                            if (moveTogether) {
                                //仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
                                offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
                            }
                            break;
                        case 'main-move-scalable':
                            if (moveTogether) {
                                //仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
                                offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
                            }
                            classList.add('mui-scalable');
                            break;
                        case 'menu-move':
                            classList.add('mui-slide-in');
                            break;
                        case 'all-move':
                            moveTogether = true;
                            //整体滑动时，侧滑菜单在inner-wrap内
                            offCanvasInner.insertBefore(offCanvasSide, offCanvasInner.firstElementChild);
                            break;
                    }
                    offCanvasWrapper.offCanvas().refresh();
                }
            });

            //主界面‘显示侧滑菜单’按钮的点击事件
            //document.getElementById('offCanvasShow').addEventListener('tap', function () {
            //    offCanvasWrapper.offCanvas('show');
            //});
            //菜单界面，‘关闭侧滑菜单’按钮的点击事件
            //document.getElementById('offCanvasHide').addEventListener('tap', function () {
            //    offCanvasWrapper.offCanvas('close');
            //});
            //主界面和侧滑菜单界面均支持区域滚动；
            mui('#offCanvasSideScroll').scroll();
            mui('#offCanvasContentScroll').scroll();
            //实现ios平台原生侧滑关闭页面；
            if (mui.os.plus && mui.os.ios) {
                mui.plusReady(function () { //5+ iOS暂时无法屏蔽popGesture时传递touch事件，故该demo直接屏蔽popGesture功能
                    plus.webview.currentWebview().setStyle({
                        'popGesture': 'none'
                    });
                });
            }

            //菜单界面，‘关闭侧滑菜单’按钮的点击事件
            document.getElementById('offCanvasHide_qry').addEventListener('tap', function () {
                mui('#offCanvasContentScroll').pullRefresh().enablePullupToRefresh();
                //查询事件
                SearchAsnList(false);
                offCanvasWrapper.offCanvas('close');
            });

            $(document).ready(function () {     
                $("#btnReturn").bind("tap", function () {
                    location.href = "/PDA/Main/@ViewBag.UserNo";
                });           

            });
           

		</script>

	</body>

</html>
